#!/bin/bash

function check-builtin {
  local command="$1" esc='(\[[ -?]*[@-~])*'
  grc --color --exclude=./test "(^|[^/])\b$command\b" |
    grep -Ev "^$esc([^[:space:]]$esc)+[[:space:]]*#|(\b|$esc)builtin$esc([[:space:]]$esc)+$command(\b|$esc)"
}

# check-builtin echo
# check-builtin printf
# check-builtin eval

function check-bash300bug {
  echo "--- $FUNCNAME ---"
  # bash-3.0 ã§ã¯ local arr=(1 2 3) ã¨ã™ã‚‹ã¨
  # local arr='(1 2 3)' ã¨è§£é‡ˆã•ã‚Œã¦ã—ã¾ã†ã€‚
  grc 'local [a-zA-Z_]+=\(' --exclude=test
  echo
}

function check-bash301bug-array-element-length {
  echo "--- $FUNCNAME ---"
  # bash-3.1 ã§ ${#arr[index]} ã‚’ç”¨ã„ã‚‹ã¨ã€
  # æ—¥æœ¬èªã®æ–‡å­—æ•°ãŒå¤‰ã«ãªã‚‹ã€‚
  grc '\$\{#[[:alnum:]]+\[[^@*]' --exclude=test
  echo
}

check-bash300bug
check-bash301bug-array-element-length
