# make scripts and programs

- `canvas.c2w.wcwidth*.cpp` ... These C++ codes are used to generate the character-width table by the C-library implementations and different terminal implementations.
  [`src/canvas.c2w.musl.sh`](../src/canvas.c2w.musl.sh) is generated by this program.
- `canvas.c2w.list-ucsver-detection-codes.sh` ... This script is used to analyze the character-width table based on the Unicode database.
  The character codes used by the test for [`bleopt char_width_{mode,version}=auto`] are determined based on the result of this script.
- `canvas.emoji.sh` ... This script is used to test the emoji supports of different terminals.
- `mwg_pp.awk` ... This is a preprocessor program written in AWK, which is used to preprocess and combine multiple shell scripts into a single file `ble.sh`.
  The source repository is [`akinomyoga/mwg_pp`](https://github.com/akinomyoga/mwg_pp).
- `debug.leakvar.exclude-list.txt` ... This is a white list for the global variables.


## `canvas.c2w.generate-table.sh`

This script file downloads data of Unicode properties from the Unicode database and
generates various tables.

```bash
$ make/canvas.c2w.generate-table.sh c2w

src/canvas.c2w.sh

$ make/canvas.c2w.generate-table.sh convert-custom-c2w <array-name> < input > output

src/canvas.c2w.musl.sh

$ make/canvas.c2w.generate-table.sh emoji

src/canvas.emoji.sh

$ make/canvas.c2w.generate-table.sh GraphemeClusterBreak

src/canvas.GraphemeClusterBreak.sh
lib/test-canvas.GraphemeClusterTest.sh

```

## `color.sample.sh`

This script is used to choose the colors in the default faces.  To show the
color sample for the brightness, the following command can be used:

```bash
$ make/color.sample.sh show-brightness-sample
```

The above command shows the sample of brightness in the grayscale foreground
characters in black and white backgrounds.

To list the safe colors, one can run the following command.  The HTML output is
available
[here](https://akinomyoga.github.io/ble.sh/color.sample.safe-colors.html).


```bash
$ make/color.sample.sh list-safe-colors [-t (ansi|html|markdown)] \
                                [-bB | -y MINBRIGHT | -Y MAXBRIGHT] \
                                [-dD | -E (cie76|cie94|ITP)]
```

The accepted range of the brightness can be specified by the options `-y
MINBRIGHT` and `-Y MAXBRIGHT`.  To enable/disable the filtering by the
brightness, one can use the option `-b`/`-B`.  The filtering by the brightness
is enabled by default.  To enable/disable the filtering the the distances from
white and black, one can use the option `-d`/`-D`.  The definition of the color
distance can be specified by the option `-E COLORDISTANCE`.  The output format
can be specified by the option `-t TYPE`.

To generate a patch to modify unsafe colors, one can run the following command:

```bash
$ make/color.sample.sh patch1       # suggested changes are printed to stdout
$ make/color.sample.sh patch1-save  # patch is saved to a.patch
```

To generate a list of base16 themes for `bleopt colorglass_base16_palette`, the
following command can be used.  The HTML output is available
[here](https://akinomyoga.github.io/ble.sh/colorglass.base16.html).

```bash
make/color.sample.sh generate-base16-sample [-t (ansi|html|markdown)]
```

## Update airline themes in the contrib repository

First install `vim-airline` and `vim-airline-themes` using `vim-plug`. Then
create a directory at `out/data/airline`:

```bash
mkdir -p out/data/airline
```


Open Vim and run the following commands:

```vim
:source make/vim-airline.DumpAirlineThemes.vim
:call DumpAirlineThemeAll()
```

This can take time. Finally, you can run the following command in a ble.sh
session.

```bash
(source make/vim-airline.ConvertAirlineThemes.sh)
```
